<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>High Precision Timing of R Expressions • bench</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="jquery.sticky-kit.min.js"></script><script src="pkgdown.js"></script><meta property="og:title" content="High Precision Timing of R Expressions">
<meta property="og:description" content="Tools to accurately benchmark and analyze execution times for R expressions.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">bench</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-lib/bench">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="bench" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#bench" class="anchor"></a>bench</h1></div>

<p>The goal of bench is to benchmark code, tracking both the execution time, memory allocated and number and type of garbage collections.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the development version from <a href="https://github.com/">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># install.packages("devtools")</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"r-lib/bench"</span>)</a></code></pre></div>
</div>
<div id="features" class="section level2">
<h2 class="hasAnchor">
<a href="#features" class="anchor"></a>Features</h2>
<p><code><a href="reference/mark.html">bench::mark()</a></code> is used to benchmark one or a series of expressions, it has a number of advantages over <a href="#alternatives">alternatives</a>.</p>
<ul>
<li>Always uses the highest precision APIs available for each operating system (often nanoseconds).</li>
<li>Tracks memory allocations for each expression.</li>
<li>Tracks the number and type of R garbage collections per expression iteration.</li>
<li>Verifies equality of expression results, to avoid accidentally benchmarking inequivalent code.</li>
<li>Has two arguments, <code>setup</code> and <code>parameters</code>, to make running benchmarks over different size datasets more straightforward.</li>
<li>Uses adaptive stopping by default, running each expression for a set amount of time rather than for a specific number of iterations.</li>
<li>Expressions are run in batches and summary statistics are calculated after filtering for iterations with garbage collections. This allows you to isolate the effects of garbage collection on running time (for more details see <a href="https://radfordneal.wordpress.com/2014/02/02/inaccurate-results-from-microbenchmark/">Neal 2014</a>).</li>
</ul>
<p>The times and memory usage are returned as custom objects which have human readable formatting for display (e.g. <code>104ns</code>) and comparisons (e.g. <code>x$mem_alloc &gt; "10MB"</code>).</p>
<p>There is also full support for <a href="http://ggplot2.tidyverse.org/">ggplot2</a> including custom scales and formatting.</p>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>Benchmarks can be run with <code><a href="reference/mark.html">bench::mark()</a></code>, which takes one or more expressions to benchmark against each other.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(bench)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">42</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">10000</span>, <span class="dv">1</span>, <span class="dv">1000</span>), <span class="dt">y=</span><span class="kw">runif</span>(<span class="dv">10000</span>, <span class="dv">1</span>, <span class="dv">1000</span>))</a></code></pre></div>
<p><code><a href="reference/mark.html">bench::mark()</a></code> will throw an error if the results are not equivalent, so you don’t accidentally benchmark inequivalent code.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">bench<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/bench/topics/mark">mark</a></span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  dat[dat<span class="op">$</span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">500</span>, ],</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  dat[<span class="kw">which</span>(dat<span class="op">$</span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">499</span>), ],</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  <span class="kw">subset</span>(dat, x <span class="op">&gt;</span><span class="st"> </span><span class="dv">500</span>))</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; Error: All results must equal the first result:</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt;   `dat[dat$x &gt; 500, ]` does not equal `dat[which(dat$x &gt; 499), ]`</span></a></code></pre></div>
<p>Results are easy to interpret, with human readable units.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">bench<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/bench/topics/mark">mark</a></span>(</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  dat[dat<span class="op">$</span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">500</span>, ],</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  dat[<span class="kw">which</span>(dat<span class="op">$</span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">500</span>), ],</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  <span class="kw">subset</span>(dat, x <span class="op">&gt;</span><span class="st"> </span><span class="dv">500</span>))</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; # A tibble: 3 x 10</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;   expression                     min     mean   median      max `itr/sec` mem_alloc  n_gc n_itr total_time</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;   &lt;chr&gt;                     &lt;bch:tm&gt; &lt;bch:tm&gt; &lt;bch:tm&gt; &lt;bch:tm&gt;     &lt;dbl&gt; &lt;bch:byt&gt; &lt;dbl&gt; &lt;int&gt;   &lt;bch:tm&gt;</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; 1 dat[dat$x &gt; 500, ]           313µs    394µs    361µs   1.31ms     2539.      416K    51   902      355ms</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; 2 dat[which(dat$x &gt; 500), ]    239µs    295µs    273µs   1.34ms     3393.      357K    51  1066      314ms</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; 3 subset(dat, x &gt; 500)         386µs    478µs    431µs   1.43ms     2092.      548K    38   763      365ms</span></a></code></pre></div>
<p>The <code><a href="reference/mark.html">bench::mark</a></code> argument <code>setup</code> allows you to run code before each expression. The argument <code>parameters</code> allows you to define a <code>list()</code> (or <code>data.frame()</code>) of parameters to assign before running <code>setup</code>. If <code>parameters</code> is a <code>list()</code> all combinations of the parameters will be enumerated by <code>expand.grid()</code>. This allows you to benchmark a set of expressions across a wide variety of input sizes, among other things.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">42</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">create_df &lt;-<span class="st"> </span><span class="cf">function</span>(rows, cols) {</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="kw">as.data.frame</span>(<span class="kw">setNames</span>(</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">    <span class="kw">replicate</span>(cols, <span class="kw">runif</span>(rows, <span class="dv">1</span>, <span class="dv">1000</span>), <span class="dt">simplify =</span> <span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">    <span class="kw">rep_len</span>(<span class="kw">c</span>(<span class="st">"x"</span>, letters), cols)))</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"></a>
<a class="sourceLine" id="cb5-9" data-line-number="9">results &lt;-<span class="st"> </span>bench<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/bench/topics/mark">mark</a></span>(</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">  <span class="dt">setup =</span> dat &lt;-<span class="st"> </span><span class="kw">create_df</span>(rows, cols),</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">  <span class="dt">parameters =</span> <span class="kw">list</span>(<span class="dt">rows =</span> <span class="kw">c</span>(<span class="dv">10000</span>, <span class="dv">100000</span>), <span class="dt">cols =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">100</span>)),</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">  <span class="dt">min_time =</span> <span class="fl">.5</span>,</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">  <span class="dt">min_iterations =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb5-14" data-line-number="14"></a>
<a class="sourceLine" id="cb5-15" data-line-number="15">  <span class="dt">bracket =</span> dat[dat<span class="op">$</span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">500</span>, ],</a>
<a class="sourceLine" id="cb5-16" data-line-number="16">  <span class="dt">which =</span> dat[<span class="kw">which</span>(dat<span class="op">$</span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">500</span>), ],</a>
<a class="sourceLine" id="cb5-17" data-line-number="17">  <span class="dt">subset =</span> <span class="kw">subset</span>(dat, x <span class="op">&gt;</span><span class="st"> </span><span class="dv">500</span>))</a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt; Running benchmark with:</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt;     rows  cols</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt; 1  10000    10</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt; 2 100000    10</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">#&gt; 3  10000   100</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co">#&gt; 4 100000   100</span></a></code></pre></div>
</div>
<div id="plotting" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting" class="anchor"></a>Plotting</h2>
<p><code><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">ggplot2::autoplot()</a></code> can be used to generate an informative default plot. This plot is colored by gc type and faceted by parameters (if any). By default it generates a <a href="https://github.com/eclarke/ggbeeswarm#geom_quasirandom">beeswarm</a> plot, however you can also use specify other plot types (<code>jitter</code>, <code>ridge</code>, <code>boxplot</code>, <code>violin</code>). See <code><a href="reference/autoplot.bench_mark.html">?autoplot.bench_mark</a></code> for full details.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">ggplot2<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/autoplot">autoplot</a></span>(results)</a></code></pre></div>
<p><img src="reference/figures/README-autoplot-1.png" width="100%"></p>
<p>You can also produce fully custom plots by unnesting the results and working with the data directly.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">results <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">  </span><span class="kw">unnest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(gc <span class="op">==</span><span class="st"> "none"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mem_alloc, <span class="dt">y =</span> time, <span class="dt">color =</span> expression)) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">"lm"</span>, <span class="dt">se =</span> F) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="st">    </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">"qual"</span>, <span class="dt">palette =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="reference/figures/README-custom-plot-1.png" width="100%"></p>
</div>
<div id="system_time" class="section level2">
<h2 class="hasAnchor">
<a href="#system_time" class="anchor"></a><code><a href="reference/system_time.html">system_time()</a></code>
</h2>
<p><strong>bench</strong> also includes <code><a href="reference/system_time.html">system_time()</a></code>, a higher precision alternative to <a href="https://www.rdocumentation.org/packages/base/versions/3.5.0/topics/system.time">system.time()</a>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">bench<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/bench/topics/system_time">system_time</a></span>({ i &lt;-<span class="st"> </span><span class="dv">1</span>; <span class="cf">while</span>(i <span class="op">&lt;</span><span class="st"> </span><span class="fl">1e7</span>) i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span> })</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt; process    real </span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt;   356ms   360ms</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4">bench<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/bench/topics/system_time">system_time</a></span>(<span class="kw">Sys.sleep</span>(.<span class="dv">5</span>))</a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt; process    real </span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt;    62µs   504ms</span></a></code></pre></div>
</div>
<div id="alternatives" class="section level2">
<h2 class="hasAnchor">
<a href="#alternatives" class="anchor"></a>Alternatives</h2>
<ul>
<li><a href="https://cran.r-project.org/package=rbenchmark">rbenchmark</a></li>
<li><a href="https://cran.r-project.org/package=microbenchmark">microbenchmark</a></li>
<li><a href="https://cran.r-project.org/package=tictoc">tictoc</a></li>
<li><a href="https://www.rdocumentation.org/packages/base/versions/3.5.0/topics/system.time">system.time()</a></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/r-lib/bench">https://​github.com/​r-lib/​bench</a>
</li>
<li>Report a bug at <br><a href="https://github.com/r-lib/bench/issues">https://​github.com/​r-lib/​bench/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="http://jimhester.com">Jim Hester</a> <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/r-lib/bench"><img src="https://travis-ci.org/r-lib/bench.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://ci.appveyor.com/project/jimhester/bench"><img src="https://ci.appveyor.com/api/projects/status/github/jimhester/bench?branch=master&amp;svg=true" alt="AppVeyor build status"></a></li>
<li><a href="https://codecov.io/github/r-lib/bench?branch=master"><img src="https://codecov.io/gh/r-lib/bench/branch/master/graph/badge.svg" alt="Coverage status"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://jimhester.com">Jim Hester</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
